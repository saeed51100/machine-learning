I am developing a time-series classification pipeline in Python (Jupyter Notebook) to identify Forex price trend regimes based on historical price data.
The dataset consists of approximately 170,000 rows of Forex OHLCV data on the H1 (hourly) timeframe, with the following characteristics:
* Dataset Description
     The dataset contains a 'CLOSE' price column and a corresponding 'Label' column that indicates price trend events with three classes:
        0 → No meaningful trend (sideways / flat movement)
        1 → Bullish trend
        2 → Bearish trend

* Request
I have implemented a labeling algorithm that assigns these labels based on price movements.
Please study the following code carefully and make the necessary improvements to achieve a robust and scalable code in my code.
Focus on only one important improvement (the most important weakness) and write me the complete and corrected version of the code.
// my code
